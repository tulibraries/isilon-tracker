<% content_for :title do %>
  Reporting Dashboard
<% end %>

<header class="main-content__header">
  <h1 class="main-content__page-title">Migration Reporting</h1>
</header>

<section class="main-content__body">
  <div class="charts-grid">
    <div class="chart-card decision-progress-card">
      <div class="decision-progress-header">
        <div>
          <h2>Decision Progress At A Glance</h2>
          <p class="chart-description">
            Percentage of assets with final migration decisions versus those needing review or further investigation.
          </p>
        </div>
        <div class="decision-progress-total text-end">
          <span class="total-label">Total assets</span>
          <strong><%= number_with_delimiter(@decision_progress[:total]) %></strong>
        </div>
      </div>

      <%= bar_chart [
        { name: "Decision Made", data: { "All Assets" => @decision_progress[:decision_made][:percentage] } },
        { name: "Decision Pending", data: { "All Assets" => @decision_progress[:decision_pending][:percentage] } }
      ],
        stacked: true,
        suffix: "%",
        min: 0,
        max: 100,
        height: "220px",
        colors: ["#2563eb", "#f59e0b"],
        legend: false,
        library: {
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                beginAtZero: true,
                stacked: true,
                max: 100
              },
              y: {
                stacked: true,
                grid: {
                  display: false
                }
              }
            }
          }
        } %>

      <ul class="decision-progress-breakdown">
        <li>
          <div class="label">
            <span class="dot dot-made"></span>
            Decision Made
          </div>
          <div class="value">
            <strong><%= number_with_precision(@decision_progress[:decision_made][:percentage], precision: 1, strip_insignificant_zeros: true) %>%</strong>
            (<%= number_with_delimiter(@decision_progress[:decision_made][:count]) %> assets)
          </div>
        </li>
        <li>
          <div class="label">
            <span class="dot dot-pending"></span>
            Decision Pending
          </div>
          <div class="value">
            <strong><%= number_with_precision(@decision_progress[:decision_pending][:percentage], precision: 1, strip_insignificant_zeros: true) %>%</strong>
            (<%= number_with_delimiter(@decision_progress[:decision_pending][:count]) %> assets)
          </div>
        </li>
      </ul>
    </div>

    <div class="chart-card migration-status-card">
      <div class="migration-status-header">
        <div>
          <h2>Migration Status Overview</h2>
          <p class="chart-description">
            Number of assets assigned to each migration status.
          </p>
        </div>
      </div>

      <%= bar_chart @migration_status_overview,
        height: "260px",
        colors: ["#9fb4ec"],
        library: {
          options: {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: "y",
            elements: {
              bar: {
                borderColor: "#7c8fcf",
                borderWidth: 1,
                borderRadius: 6
              }
            },
            scales: {
              x: {
                beginAtZero: true,
                grid: {
                  color: "rgba(0, 0, 0, 0.05)"
                }
              },
              y: {
                grid: {
                  display: false
                }
              }
            },
            plugins: {
              legend: {
                display: false
              }
            }
          }
        } %>
    </div>

  </div>
</section>

<style>
  .charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 2rem;
  }

  .chart-card {
    background: #fff;
    border-radius: 0.5rem;
    padding: 1.5rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.05);
    border: 1px solid rgba(0, 0, 0, 0.05);
  }

  .chart-card h2 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }

  .chart-card .chart-description {
    color: #4b5563;
    font-size: 0.95rem;
    margin-bottom: 0;
  }

  .migration-status-card {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .decision-progress-header {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .decision-progress-total {
    font-size: 0.9rem;
    color: #6b7280;
  }

  .decision-progress-total strong {
    display: block;
    font-size: 1.75rem;
    color: #111827;
  }

  .decision-progress-breakdown {
    list-style: none;
    padding: 0;
    margin: 1rem 0 0;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    font-size: 0.95rem;
  }

  .decision-progress-breakdown li {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border: 1px solid rgba(0, 0, 0, 0.05);
    border-radius: 0.4rem;
    padding: 0.5rem 0.75rem;
  }

  .decision-progress-breakdown .label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: #111827;
  }

  .decision-progress-breakdown .value {
    color: #374151;
    font-weight: 500;
  }

  .decision-progress-breakdown .dot {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 999px;
    display: inline-block;
  }

  .decision-progress-breakdown .dot-made {
    background-color: #2563eb;
  }

  .decision-progress-breakdown .dot-pending {
    background-color: #f59e0b;
  }

  @media (max-width: 768px) {
    .decision-progress-header {
      flex-direction: column;
    }

    .decision-progress-breakdown li {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.25rem;
    }

    .decision-progress-breakdown .value {
      width: 100%;
    }
  }
</style>
