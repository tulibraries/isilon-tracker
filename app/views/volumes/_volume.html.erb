<div id="<%= dom_id volume %>" data-controller="batch-actions">

  <h1 class="volume-name"><%= "Volume: #{volume.name}" %></h1>

  <!-- Flash Messages Container -->
  <div id="flash-messages"></div>

  <div id="tree-filter-row">
    <label for="tree-filter">Filter:</label>
    <input
      id="tree-filter"
      type="search"
      placeholder="Enter search pattern"
      autofocus
    />

    <button
      id="filter-mode-toggle"
      type="button"
      class="icon-button"
      title="Hide unmatched nodes"
    >
      <i class="bi bi-filter-square search-icon"></i>
    </button>

    <button id="clear-filters" class="btn btn-primary" type="button">
      Clear All Filters
      <i class="bi bi-x-square ms-1"></i>
    </button>
    
    <!-- Batch Actions Button (hidden initially) -->
    <button type="button" 
            id="asset-batch-actions-btn"
            class="btn btn-primary ms-3" 
            data-action="click->batch-actions#openAssetModal"
            style="display: none;">
      <i class="bi bi-lightning-fill me-1"></i>
      Batch Actions (<span data-batch-actions-target="selectedAssetCount">0</span>)
    </button>
  </div>

  <div
    id="tree"
    data-controller="wunderbaum"
    data-wunderbaum-url-value="<%= file_tree_volume_path(volume.id) %>"
    data-wunderbaum-volume-id-value="<%= volume.id %>" 
  ></div>

  <!-- Asset Batch Actions Modal -->
  <div class="modal fade" id="assetBatchActionsModal" tabindex="-1" aria-labelledby="assetBatchActionsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <h5 class="modal-title" id="assetBatchActionsModalLabel">
              Batch Actions (<span data-batch-actions-target="selectedAssetCount">0</span> items)
            </h5>
            <p class="text-muted mb-0 small">Update selected assets and folders</p>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <%= form_with url: volume_batch_actions_path(volume), method: :patch, 
                        class: "batch-actions-form",
                        data: { 
                          "batch-actions-target": "form",
                          "action": "submit->batch-actions#submitBatchAction"
                        },
                        local: false do |form| %>
            
            <p class="text-muted mb-4">
              Update any or all of the fields below. Asset-specific fields (Migration Status, ArchivesSpace Collection, etc.) will only be applied to selected assets. The Assigned User field will be applied to both selected assets and folders.
            </p>
            
            <!-- Hidden fields for selected IDs -->
            <%= form.hidden_field :asset_ids, data: { "batch-actions-target": "assetIds" } %>
            <%= form.hidden_field :folder_ids, data: { "batch-actions-target": "folderIds" } %>
            
            <!-- Migration Status Update -->
            <div class="mb-4">
              <label class="form-label fw-bold">Migration Status</label>
              <%= form.select :migration_status_id, 
                    options_for_select([['Unchanged', '']] + MigrationStatus.all.map { |ms| [ms.name, ms.id] }, ''), 
                    {}, 
                    { class: "form-select" } %>
              <div class="form-text">Select a new migration status for the selected assets</div>
            </div>
            
            <!-- Assigned User Update -->
            <div class="mb-4">
              <label class="form-label fw-bold">Assigned User</label>
              <%= form.select :assigned_user_id, 
                    options_for_select([['Unchanged', ''], ['Unassigned', 'unassigned']] + User.all.map { |u| [u.title, u.id] }, ''), 
                    {}, 
                    { class: "form-select" } %>
              <div class="form-text">Assign or reassign the selected assets and folders to a user</div>
            </div>
            
            <!-- ASpace Collection Update -->
            <div class="mb-4">
              <label class="form-label fw-bold">ASpace Collection</label>
              <%= form.select :aspace_collection_id, 
                    options_for_select([['Unchanged', '']] + AspaceCollection.all.map { |ac| [ac.name, ac.id] }, ''), 
                    {}, 
                    { class: "form-select" } %>
              <div class="form-text">Set the ASpace collection for the selected assets</div>
            </div>
            
            <!-- ASpace Linking Status Update -->
            <div class="mb-4">
              <label class="form-label fw-bold d-block">ASpace Linking Status</label>
              <div class="form-check form-check-inline">
                <%= form.radio_button :aspace_linking_status, '', 
                      { class: "form-check-input", checked: true, id: "aspace_linking_unchanged" } %>
                <label class="form-check-label" for="aspace_linking_unchanged">Unchanged</label>
              </div>
              <div class="form-check form-check-inline">
                <%= form.radio_button :aspace_linking_status, 'true', 
                      { class: "form-check-input", id: "aspace_linking_true" } %>
                <label class="form-check-label" for="aspace_linking_true">Linked</label>
              </div>
              <div class="form-check form-check-inline">
                <%= form.radio_button :aspace_linking_status, 'false', 
                      { class: "form-check-input", id: "aspace_linking_false" } %>
                <label class="form-check-label" for="aspace_linking_false">Not Linked</label>
              </div>
              <div class="form-text">Set the ASpace linking status for the selected assets</div>
            </div>
            
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              <%= form.submit "Apply Asset Updates", class: "btn btn-primary" %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>



</div>
